<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adem tracker</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #00b894 0%, #00cec9 50%, #81ecec 100%);
            min-height: 100vh;
            color: #2d3436;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Loading Spinner */
        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            flex-direction: column;
            color: white;
        }

        .spinner {
            border: 4px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top: 4px solid white;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Auth Modal */
        .auth-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .auth-container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .auth-header h2 {
            color: #2d3436;
            margin-bottom: 10px;
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 30px;
            border-radius: 10px;
            overflow: hidden;
            background: #f8f9fa;
        }

        .auth-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            background: #f8f9fa;
            color: #636e72;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            font-weight: 600;
        }

        .auth-tab.active {
            background: #00b894;
            color: white;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .auth-input {
            width: 100%;
            padding: 15px;
            margin-bottom: 15px;
            border: 2px solid #ddd6fe;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .auth-input:focus {
            outline: none;
            border-color: #00b894;
        }

        .auth-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #00b894, #00cec9);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 15px;
            transition: transform 0.3s;
        }

        .auth-btn:hover {
            transform: translateY(-2px);
        }

        .google-btn {
            background: white;
            color: #2d3436;
            border: 2px solid #ddd6fe;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .google-btn:hover {
            border-color: #00b894;
        }

        .auth-divider {
            text-align: center;
            margin: 20px 0;
            position: relative;
        }

        .auth-divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #ddd6fe;
        }

        .auth-divider span {
            background: white;
            padding: 0 15px;
            color: #636e72;
        }

        .error-message {
            background: #ff7675;
            color: white;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            text-align: center;
            display: none;
        }

        .success-message {
            background: #00b894;
            color: white;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            text-align: center;
            display: none;
        }

        /* User Profile */
        .user-profile {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 10px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
        }

        .user-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: #00b894;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .logout-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 8px;
            cursor: pointer;
            margin-left: 10px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            margin-top: 60px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .header-icon {
            font-size: 0.8em;
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 50%;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .nav-tab {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.2);
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-tab:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .nav-tab.active {
            background: white;
            color: #00b894;
            border-color: white;
        }

        .tab-content {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Sync indicator */
        .sync-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255,255,255,0.9);
            padding: 10px 15px;
            border-radius: 25px;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            font-size: 0.9em;
            z-index: 100;
        }

        .sync-indicator.syncing {
            color: #fdcb6e;
        }

        .sync-indicator.synced {
            color: #00b894;
        }

        .sync-indicator.error {
            color: #e17055;
        }

        /* Dashboard Styles */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .dashboard-card {
            background: linear-gradient(135deg, #ffffff, #f1f2f6);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            border-left: 5px solid #00b894;
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.15);
        }

        .dashboard-card h3 {
            color: #2d3436;
            margin-bottom: 15px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-icon {
            background: linear-gradient(135deg, #00b894, #00cec9);
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
        }

        .metric-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #00b894;
            margin-bottom: 5px;
        }

        .metric-label {
            color: #636e72;
            font-size: 0.9em;
        }

        /* Checklist Styles */
        .checklist-section {
            margin-bottom: 30px;
        }

        .checklist-title {
            color: #2d3436;
            font-size: 1.4em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-icon {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
        }

        .checklist-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
        }

        .checklist-item {
            background: white;
            border: 2px solid #ddd6fe;
            border-radius: 12px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .checklist-item:hover {
            border-color: #00b894;
            box-shadow: 0 5px 15px rgba(0, 184, 148, 0.1);
        }

        .checklist-item.completed {
            background: #d1f2eb;
            border-color: #00b894;
        }

        .checklist-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #ddd;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: white;
            background: #f8f9fa;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .checklist-item.completed .checklist-checkbox {
            background: #00b894;
            border-color: #00b894;
        }

        .checklist-item.syncing::after {
            content: '';
            position: absolute;
            top: 5px;
            right: 5px;
            width: 10px;
            height: 10px;
            border: 2px solid #fdcb6e;
            border-top: 2px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* Symptom Tracker Styles */
        .symptom-form {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #00cec9;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2d3436;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .label-icon {
            color: #00b894;
            font-size: 0.9em;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd6fe;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #00b894;
            box-shadow: 0 0 0 3px rgba(0, 184, 148, 0.1);
        }

        .intensity-slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(to right, #00b894, #fdcb6e, #e17055);
            outline: none;
            -webkit-appearance: none;
            margin: 10px 0;
        }

        .intensity-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            border: 3px solid #00b894;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .intensity-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            border: 3px solid #00b894;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .submit-btn {
            background: linear-gradient(135deg, #00b894, #00cec9);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            position: relative;
        }

        .submit-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 184, 148, 0.3);
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .submit-btn.loading::after {
            content: '';
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 8px;
        }

        /* Exercise Styles */
        .exercise-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #74b9ff;
        }

        .exercise-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .exercise-title {
            font-size: 1.3em;
            color: #2d3436;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .exercise-icon {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
        }

        .exercise-duration {
            background: #00b894;
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .exercise-steps {
            margin-bottom: 20px;
        }

        .exercise-step {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            margin-bottom: 12px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 3px solid #ddd6fe;
        }

        .step-number {
            background: #00b894;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
            font-weight: bold;
            flex-shrink: 0;
        }

        .breathing-timer {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #00b894, #00cec9);
            color: white;
            border-radius: 15px;
            margin-top: 20px;
        }

        .breathing-circle {
            width: 200px;
            height: 200px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            margin: 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: all 4s ease-in-out;
        }

        .breathing-circle::before {
            content: '\f1b1';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            font-size: 2em;
            color: rgba(255,255,255,0.8);
        }

        .breathing-circle.inhale {
            transform: scale(1.3);
            border-color: rgba(255, 255, 255, 0.8);
        }

        .breathing-circle.exhale {
            transform: scale(0.8);
            border-color: rgba(255, 255, 255, 0.8);
        }

        .timer-display {
            font-size: 3em;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .timer-phase {
            font-size: 1.2em;
            margin-bottom: 20px;
            opacity: 0.9;
        }

        .timer-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .timer-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .timer-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Progress Chart */
        .progress-chart {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #a29bfe;
        }

        .chart-placeholder {
            height: 300px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #636e72;
            font-size: 1.1em;
            flex-direction: column;
            gap: 10px;
        }

        .chart-icon {
            font-size: 3em;
            color: #ddd6fe;
        }

        /* Status indicators */
        .status-positive { color: #00b894; }
        .status-warning { color: #fdcb6e; }
        .status-negative { color: #e17055; }

        /* Checkbox styling */
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 5px;
            border-radius: 5px;
            transition: background-color 0.2s;
        }

        .checkbox-group label:hover {
            background-color: rgba(0, 184, 148, 0.1);
        }

        /* Week view styling */
        .week-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .day-card {
            text-align: center;
            padding: 15px;
            border-radius: 12px;
            transition: transform 0.2s;
        }

        .day-card:hover {
            transform: translateY(-2px);
        }

        .day-completed { background: linear-gradient(135deg, #d1f2eb, #b2dfdb); }
        .day-partial { background: linear-gradient(135deg, #fff3cd, #ffe0b3); }
        .day-today { background: linear-gradient(135deg, #e1bee7, #ce93d8); }
        .day-future { background: linear-gradient(135deg, #f5f5f5, #e0e0e0); }

        .day-icon {
            font-size: 2em;
            margin: 10px 0;
        }

        /* Achievement badges */
        .achievement-badge {
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .achievement-bronze {
            background: linear-gradient(135deg, #cd7f32, #daa520);
            color: white;
        }

        .achievement-silver {
            background: linear-gradient(135deg, #c0c0c0, #a8a8a8);
            color: white;
        }

        .achievement-gold {
            background: linear-gradient(135deg, #ffd700, #ffb347);
            color: white;
        }

        .achievement-locked {
            background: #f8f9fa;
            color: #636e72;
            opacity: 0.6;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2em;
                flex-direction: column;
                gap: 10px;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .checklist-items {
                grid-template-columns: 1fr;
            }
            
            .nav-tabs {
                flex-direction: column;
                align-items: center;
                gap: 5px;
            }

            .nav-tab {
                width: 100%;
                max-width: 300px;
                justify-content: center;
            }
            
            .timer-display {
                font-size: 2em;
            }

            .week-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .exercise-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .tab-content {
                padding: 20px 15px;
            }

            .user-profile {
                position: relative;
                top: 0;
                right: 0;
                margin-bottom: 20px;
                justify-content: center;
            }

            .breathing-circle {
                width: 150px;
                height: 150px;
            }

            .auth-container {
                margin: 20px;
                padding: 30px 20px;
            }

            /* Chart responsive adjustments */
            .progress-chart canvas {
                min-height: 250px !important;
            }

            /* Make charts grid single column on mobile */
            div[style*="grid-template-columns: repeat(auto-fit, minmax(400px, 1fr))"] {
                grid-template-columns: 1fr !important;
            }

            /* Compact insights on mobile */
            .dashboard-card h3 {
                font-size: 1.1em;
            }

            .dashboard-card {
                padding: 20px;
            }

            /* Make week grid more compact on mobile */
            .week-grid {
                grid-template-columns: repeat(7, 1fr);
                gap: 8px;
            }

            .day-card {
                padding: 10px 5px;
                font-size: 0.9em;
            }

            .day-icon {
                font-size: 1.5em !important;
                margin: 5px 0 !important;
            }
        }

        /* Chart container styles */
        .progress-chart canvas {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
        }

        /* Activity heatmap responsive */
        #activityHeatmap > div:first-child {
            margin: 0 auto;
        }

        @media (max-width: 480px) {
            #activityHeatmap > div:first-child {
                grid-template-columns: repeat(5, 1fr) !important;
            }
        }

        .hidden {
            display: none !important;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: #00b894;
        }

        .notification.error {
            background: #e17055;
        }

        .notification.info {
            background: #74b9ff;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-spinner">
        <div class="spinner"></div>
        <p>Laden van de app...</p>
    </div>

    <!-- Authentication Modal -->
    <div id="authModal" class="auth-modal hidden">
        <div class="auth-container">
            <div class="auth-header">
                <i class="fas fa-wind" style="font-size: 2em; color: #00b894; margin-bottom: 10px;"></i>
                <h2>Welkom bij BreathEase</h2>
                <p style="color: #636e72;">Log in om je voortgang bij te houden</p>
            </div>

            <div class="auth-tabs">
                <button class="auth-tab active" onclick="showAuthTab('login')">Inloggen</button>
                <button class="auth-tab" onclick="showAuthTab('register')">Registreren</button>
            </div>

            <div class="error-message" id="authError"></div>
            <div class="success-message" id="authSuccess"></div>

            <!-- Login Form -->
            <form class="auth-form active" id="loginForm">
                <input type="email" class="auth-input" placeholder="E-mailadres" required id="loginEmail">
                <input type="password" class="auth-input" placeholder="Wachtwoord" required id="loginPassword">
                <button type="submit" class="auth-btn">
                    <i class="fas fa-sign-in-alt"></i>
                    Inloggen
                </button>
            </form>

            <!-- Register Form -->
            <form class="auth-form" id="registerForm">
                <input type="text" class="auth-input" placeholder="Volledige naam" required id="registerName">
                <input type="email" class="auth-input" placeholder="E-mailadres" required id="registerEmail">
                <input type="password" class="auth-input" placeholder="Wachtwoord" required id="registerPassword">
                <input type="password" class="auth-input" placeholder="Bevestig wachtwoord" required id="registerConfirmPassword">
                <button type="submit" class="auth-btn">
                    <i class="fas fa-user-plus"></i>
                    Registreren
                </button>
            </form>

            <div class="auth-divider">
                <span>Of</span>
            </div>

            <button class="auth-btn google-btn" onclick="signInWithGoogle()">
                <i class="fab fa-google"></i>
                Doorgaan met Google
            </button>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="container hidden">
        <!-- User Profile -->
        <div class="user-profile">
            <div class="user-avatar" id="userAvatar">U</div>
            <span id="userName">Gebruiker</span>
            <button class="logout-btn" onclick="signOut()">
                <i class="fas fa-sign-out-alt"></i>
            </button>
        </div>

        <div class="header">
            <h1>
                <i class="fas fa-wind header-icon"></i>
                Ademhaling & Symptoom Management Tool
            </h1>
            <p>Wetenschappelijk onderbouwde technieken voor gapen, zuchten en hyperventilatie</p>
        </div>

        <div class="nav-tabs">
            <div class="nav-tab active" onclick="showTab('dashboard')">
                <i class="fas fa-chart-line"></i> Dashboard
            </div>
            <div class="nav-tab" onclick="showTab('checklist')">
                <i class="fas fa-check-square"></i> Dagelijkse Checklist
            </div>
            <div class="nav-tab" onclick="showTab('tracker')">
                <i class="fas fa-chart-bar"></i> Symptoom Tracker
            </div>
            <div class="nav-tab" onclick="showTab('exercises')">
                <i class="fas fa-meditation"></i> Oefeningen
            </div>
            <div class="nav-tab" onclick="showTab('techniques')">
                <i class="fas fa-bullseye"></i> Technieken
            </div>
            <div class="nav-tab" onclick="showTab('progress')">
                <i class="fas fa-chart-area"></i> Voortgang
            </div>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <h3>
                        <div class="card-icon"><i class="fas fa-bullseye"></i></div>
                        Vandaag Voltooid
                    </h3>
                    <div class="metric-value" id="dailyProgress">0/8</div>
                    <div class="metric-label">Dagelijkse taken</div>
                </div>
                <div class="dashboard-card">
                    <h3>
                        <div class="card-icon"><i class="fas fa-chart-line"></i></div>
                        Gemiddelde Intensiteit
                    </h3>
                    <div class="metric-value" id="avgIntensity">0</div>
                    <div class="metric-label">Laatste 7 dagen</div>
                </div>
                <div class="dashboard-card">
                    <h3>
                        <div class="card-icon"><i class="fas fa-fire"></i></div>
                        Streak
                    </h3>
                    <div class="metric-value" id="streak">0</div>
                    <div class="metric-label">Opeenvolgende dagen</div>
                </div>
                <div class="dashboard-card">
                    <h3>
                        <div class="card-icon"><i class="fas fa-clock"></i></div>
                        Totale Oefentijd
                    </h3>
                    <div class="metric-value" id="totalTime">0</div>
                    <div class="metric-label">Minuten deze week</div>
                </div>
            </div>
            
            <div class="progress-chart">
                <h3><i class="fas fa-chart-line" style="margin-right: 10px; color: #00b894;"></i>Symptoom Trend (Laatste 14 dagen)</h3>
                <div style="height: 300px; position: relative;">
                    <canvas id="dashboardSymptomChart"></canvas>
                </div>
                <div style="text-align: center; margin-top: 15px;">
                    <button class="submit-btn" onclick="showTab('progress')" style="padding: 10px 20px; font-size: 14px;">
                        <i class="fas fa-chart-area"></i>
                        Bekijk Alle Grafieken
                    </button>
                </div>
            </div>
        </div>

        <!-- Checklist Tab -->
        <div id="checklist" class="tab-content">
            <div class="checklist-section">
                <div class="checklist-title">
                    <div class="section-icon"><i class="fas fa-sunrise"></i></div>
                    Ochtend Routine
                </div>
                <div class="checklist-items">
                    <div class="checklist-item" onclick="toggleChecklist(this, 'morning_breathing')">
                        <div class="checklist-checkbox"><i class="fas fa-check"></i></div>
                        <div>
                            <strong>Diafragmatische ademhaling</strong><br>
                            <small>10 minuten na het wakker worden</small>
                        </div>
                    </div>
                    <div class="checklist-item" onclick="toggleChecklist(this, 'morning_posture')">
                        <div class="checklist-checkbox"><i class="fas fa-check"></i></div>
                        <div>
                            <strong>Postuur check</strong><br>
                            <small>Schouders, rug en hoofdpositie controleren</small>
                        </div>
                    </div>
                    <div class="checklist-item" onclick="toggleChecklist(this, 'morning_co2')">
                        <div class="checklist-checkbox"><i class="fas fa-check"></i></div>
                        <div>
                            <strong>CO2 tolerance test</strong><br>
                            <small>Control Pause meting (zie technieken tab)</small>
                        </div>
                    </div>
                </div>
            </div>

            <div class="checklist-section">
                <div class="checklist-title">
                    <div class="section-icon"><i class="fas fa-sun"></i></div>
                    Middag Routine
                </div>
                <div class="checklist-items">
                    <div class="checklist-item" onclick="toggleChecklist(this, 'afternoon_box')">
                        <div class="checklist-checkbox"><i class="fas fa-check"></i></div>
                        <div>
                            <strong>Box breathing sessie</strong><br>
                            <small>5 minuten tijdens werkpauze</small>
                        </div>
                    </div>
                    <div class="checklist-item" onclick="toggleChecklist(this, 'afternoon_log')">
                        <div class="checklist-checkbox"><i class="fas fa-check"></i></div>
                        <div>
                            <strong>Symptomen loggen</strong><br>
                            <small>Intensiteit en triggers noteren</small>
                        </div>
                    </div>
                </div>
            </div>

            <div class="checklist-section">
                <div class="checklist-title">
                    <div class="section-icon"><i class="fas fa-moon"></i></div>
                    Avond Routine
                </div>
                <div class="checklist-items">
                    <div class="checklist-item" onclick="toggleChecklist(this, 'evening_vagus')">
                        <div class="checklist-checkbox"><i class="fas fa-check"></i></div>
                        <div>
                            <strong>Vagus stimulatie</strong><br>
                            <small>Koude douche, zingen of nekmassage</small>
                        </div>
                    </div>
                    <div class="checklist-item" onclick="toggleChecklist(this, 'evening_mindfulness')">
                        <div class="checklist-checkbox"><i class="fas fa-check"></i></div>
                        <div>
                            <strong>Mindfulness oefening</strong><br>
                            <small>10-20 minuten body scan of ademmeditatie</small>
                        </div>
                    </div>
                    <div class="checklist-item" onclick="toggleChecklist(this, 'evening_review')">
                        <div class="checklist-checkbox"><i class="fas fa-check"></i></div>
                        <div>
                            <strong>Dag evalueren</strong><br>
                            <small>Welke technieken werkten het beste?</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Symptom Tracker Tab -->
        <div id="tracker" class="tab-content">
            <div class="symptom-form">
                <h3><i class="fas fa-edit" style="margin-right: 10px; color: #00cec9;"></i>Symptomen Loggen</h3>
                <form id="symptomForm">
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-calendar-alt label-icon"></i>
                            Datum & Tijd
                        </label>
                        <input type="datetime-local" class="form-input" id="symptomDateTime" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-heartbeat label-icon"></i>
                            Hoofdsymptoom
                        </label>
                        <select class="form-select" id="mainSymptom" required>
                            <option value="">Selecteer symptoom</option>
                            <option value="gaping">Geforceerd gapen</option>
                            <option value="sighing">Zuchten</option>
                            <option value="air-hunger">Luchthonger</option>
                            <option value="shortness">Kortademigheid</option>
                            <option value="chest-tightness">Borst beklemming</option>
                            <option value="dizzy">Duizeligheid</option>
                            <option value="tingling">Tintelingen</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-thermometer-half label-icon"></i>
                            Intensiteit (1-10): <span id="intensityValue">5</span>
                        </label>
                        <input type="range" class="intensity-slider" id="intensitySlider" min="1" max="10" value="5" oninput="updateIntensityValue()">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-hourglass-half label-icon"></i>
                            Duur (minuten)
                        </label>
                        <input type="number" class="form-input" id="duration" min="1" max="480" placeholder="Hoelang duurde het symptoom?">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-exclamation-triangle label-icon"></i>
                            Mogelijke Triggers
                        </label>
                        <div class="checkbox-group">
                            <label><input type="checkbox" value="stress"> <i class="fas fa-brain"></i> Stress</label>
                            <label><input type="checkbox" value="anxiety"> <i class="fas fa-heart"></i> Angst</label>
                            <label><input type="checkbox" value="eating"> <i class="fas fa-utensils"></i> Na eten</label>
                            <label><input type="checkbox" value="lying"> <i class="fas fa-bed"></i> Liggen</label>
                            <label><input type="checkbox" value="exercise"> <i class="fas fa-running"></i> Sport</label>
                            <label><input type="checkbox" value="crowd"> <i class="fas fa-users"></i> Drukte</label>
                            <label><input type="checkbox" value="heat"> <i class="fas fa-thermometer-full"></i> Warmte</label>
                            <label><input type="checkbox" value="confined"> <i class="fas fa-compress"></i> Kleine ruimte</label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-tools label-icon"></i>
                            Gebruikte Technieken
                        </label>
                        <div class="checkbox-group">
                            <label><input type="checkbox" value="diaphragmatic"> <i class="fas fa-lungs"></i> Diafragmatisch</label>
                            <label><input type="checkbox" value="box"> <i class="fas fa-square"></i> Box breathing</label>
                            <label><input type="checkbox" value="co2-training"> <i class="fas fa-atom"></i> CO2 training</label>
                            <label><input type="checkbox" value="vagus"> <i class="fas fa-wind"></i> Vagus stimulatie</label>
                            <label><input type="checkbox" value="mindfulness"> <i class="fas fa-meditation"></i> Mindfulness</label>
                            <label><input type="checkbox" value="posture"> <i class="fas fa-male"></i> Postuur</label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-star label-icon"></i>
                            Effectiviteit Technieken (1-10)
                        </label>
                        <input type="range" class="intensity-slider" id="effectivenessSlider" min="1" max="10" value="5">
                        <small>1 = Geen effect, 10 = Volledig verlicht</small>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-sticky-note label-icon"></i>
                            Aanvullende Notities
                        </label>
                        <textarea class="form-textarea" id="notes" rows="3" placeholder="Bijzonderheden, patronen, gevoelens..."></textarea>
                    </div>
                    
                    <button type="submit" class="submit-btn" id="submitSymptomBtn">
                        <i class="fas fa-save"></i>
                        Symptomen Opslaan
                    </button>
                </form>
            </div>
        </div>

        <!-- Exercises Tab -->
        <div id="exercises" class="tab-content">
            <div class="exercise-card">
                <div class="exercise-header">
                    <div class="exercise-title">
                        <div class="exercise-icon"><i class="fas fa-lungs"></i></div>
                        Diafragmatische Ademhaling
                    </div>
                    <div class="exercise-duration">
                        <i class="fas fa-clock"></i>
                        10-15 min
                    </div>
                </div>
                <div class="exercise-steps">
                    <div class="exercise-step">
                        <div class="step-number">1</div>
                        <div>Ga comfortabel liggen of zitten met rechte rug</div>
                    </div>
                    <div class="exercise-step">
                        <div class="step-number">2</div>
                        <div>Plaats één hand op je borst, de andere op je buik</div>
                    </div>
                    <div class="exercise-step">
                        <div class="step-number">3</div>
                        <div>Adem langzaam in door je neus - alleen de buikhand moet bewegen</div>
                    </div>
                    <div class="exercise-step">
                        <div class="step-number">4</div>
                        <div>Adem langzaam uit door je mond - buik zakt in</div>
                    </div>
                    <div class="exercise-step">
                        <div class="step-number">5</div>
                        <div>Herhaal 10-15 minuten, 2x per dag</div>
                    </div>
                </div>
                <button class="submit-btn" onclick="startTimer('diaphragmatic', 900)">
                    <i class="fas fa-play"></i>
                    Start Oefening (15 min)
                </button>
            </div>

            <div class="exercise-card">
                <div class="exercise-header">
                    <div class="exercise-title">
                        <div class="exercise-icon"><i class="fas fa-square"></i></div>
                        Box Breathing
                    </div>
                    <div class="exercise-duration">
                        <i class="fas fa-clock"></i>
                        5-10 min
                    </div>
                </div>
                <div class="exercise-steps">
                    <div class="exercise-step">
                        <div class="step-number">1</div>
                        <div>Adem volledig uit om te beginnen</div>
                    </div>
                    <div class="exercise-step">
                        <div class="step-number">2</div>
                        <div>Adem in gedurende 4 tellen</div>
                    </div>
                    <div class="exercise-step">
                        <div class="step-number">3</div>
                        <div>Houd je adem vast gedurende 4 tellen</div>
                    </div>
                    <div class="exercise-step">
                        <div class="step-number">4</div>
                        <div>Adem uit gedurende 4 tellen</div>
                    </div>
                    <div class="exercise-step">
                        <div class="step-number">5</div>
                        <div>Houd je adem vast gedurende 4 tellen</div>
                    </div>
                </div>
                <button class="submit-btn" onclick="startBoxBreathing()">
                    <i class="fas fa-play"></i>
                    Start Box Breathing
                </button>
            </div>

            <div class="exercise-card">
                <div class="exercise-header">
                    <div class="exercise-title">
                        <div class="exercise-icon"><i class="fas fa-bullseye"></i></div>
                        CO2 Tolerance Training
                    </div>
                    <div class="exercise-duration">
                        <i class="fas fa-clock"></i>
                        2-5 min
                    </div>
                </div>
                <div class="exercise-steps">
                    <div class="exercise-step">
                        <div class="step-number">1</div>
                        <div>Adem normaal in en uit</div>
                    </div>
                    <div class="exercise-step">
                        <div class="step-number">2</div>
                        <div>Na een normale uitademing, houd je adem vast</div>
                    </div>
                    <div class="exercise-step">
                        <div class="step-number">3</div>
                        <div>Tel de seconden tot je de eerste drang voelt om in te ademen</div>
                    </div>
                    <div class="exercise-step">
                        <div class="step-number">4</div>
                        <div>Dit is je "Control Pause" - noteer dit getal</div>
                    </div>
                    <div class="exercise-step">
                        <div class="step-number">5</div>
                        <div>Doel: verhoog van &lt;10 sec naar &gt;25 sec over tijd</div>
                    </div>
                </div>
                <button class="submit-btn" onclick="startCO2Test()">
                    <i class="fas fa-play"></i>
                    Start CO2 Test
                </button>
            </div>

            <div id="breathingTimer" class="breathing-timer hidden">
                <div class="breathing-circle" id="breathingCircle"></div>
                <div class="timer-display" id="timerDisplay">00:00</div>
                <div class="timer-phase" id="timerPhase">Bereid je voor...</div>
                <div class="timer-controls">
                    <button class="timer-btn" id="pauseBtn" onclick="pauseTimer()">
                        <i class="fas fa-pause"></i>
                        Pauzeer
                    </button>
                    <button class="timer-btn" onclick="stopTimer()">
                        <i class="fas fa-stop"></i>
                        Stop
                    </button>
                </div>
            </div>
        </div>

        <!-- Techniques Tab -->
        <div id="techniques" class="tab-content">
            <div class="exercise-card">
                <div class="exercise-header">
                    <div class="exercise-title">
                        <div class="exercise-icon"><i class="fas fa-snowflake"></i></div>
                        Vagus Zenuw Stimulatie
                    </div>
                    <div class="exercise-duration">
                        <i class="fas fa-clock"></i>
                        Variabel
                    </div>
                </div>
                <h4>Effectieve Methoden:</h4>
                <div class="exercise-steps">
                    <div class="exercise-step">
                        <div class="step-number"><i class="fas fa-shower"></i></div>
                        <div><strong>Koude Douche:</strong> Begin met 30 seconden koud water, bouw op naar 2-3 minuten</div>
                    </div>
                    <div class="exercise-step">
                        <div class="step-number"><i class="fas fa-music"></i></div>
                        <div><strong>Zingen/Neuriën:</strong> 5-10 minuten, activeert vagus via stembandtrillingen</div>
                    </div>
                    <div class="exercise-step">
                        <div class="step-number"><i class="fas fa-hand-paper"></i></div>
                        <div><strong>Nekmassage:</strong> Zachte massage langs halsslagader, 2-3 minuten</div>
                    </div>
                    <div class="exercise-step">
                        <div class="step-number"><i class="fas fa-water"></i></div>
                        <div><strong>Gargling:</strong> 30 seconden met water, 3-4x per dag</div>
                    </div>
                </div>
            </div>

            <div class="exercise-card">
                <div class="exercise-header">
                    <div class="exercise-title">
                        <div class="exercise-icon"><i class="fas fa-meditation"></i></div>
                        Mindfulness Technieken
                    </div>
                    <div class="exercise-duration">
                        <i class="fas fa-clock"></i>
                        10-20 min
                    </div>
                </div>
                <h4>MBSR Protocollen:</h4>
                <div class="exercise-steps">
                    <div class="exercise-step">
                        <div class="step-number"><i class="fas fa-search"></i></div>
                        <div><strong>Body Scan:</strong> Systematisch door hele lichaam, 15-20 minuten</div>
                    </div>
                    <div class="exercise-step">
                        <div class="step-number"><i class="fas fa-wind"></i></div>
                        <div><strong>Mindful Ademhaling:</strong> Focus op natuurlijke ademhaling, 10 minuten</div>
                    </div>
                    <div class="exercise-step">
                        <div class="step-number"><i class="fas fa-bullseye"></i></div>
                        <div><strong>Symptoom Observatie:</strong> Bekijk gapen/zuchten zonder oordeel</div>
                    </div>
                    <div class="exercise-step">
                        <div class="step-number"><i class="fas fa-sync-alt"></i></div>
                        <div><strong>Stress-Cyclus Doorbreken:</strong> Herken triggers → Pauzeer → Adem</div>
                    </div>
                </div>
            </div>

            <div class="exercise-card">
                <div class="exercise-header">
                    <div class="exercise-title">
                        <div class="exercise-icon"><i class="fas fa-chart-line"></i></div>
                        Meetinstrumenten
                    </div>
                    <div class="exercise-duration">
                        <i class="fas fa-calendar-day"></i>
                        Dagelijks
                    </div>
                </div>
                <h4>Scientifische Metingen:</h4>
                <div class="exercise-steps">
                    <div class="exercise-step">
                        <div class="step-number"><i class="fas fa-stopwatch"></i></div>
                        <div><strong>Control Pause:</strong> &lt;10s = slecht, 15-25s = gemiddeld, &gt;25s = goed</div>
                    </div>
                    <div class="exercise-step">
                        <div class="step-number"><i class="fas fa-chart-bar"></i></div>
                        <div><strong>Symptoom Intensiteit:</strong> 1-3 = mild, 4-6 = matig, 7-10 = ernstig</div>
                    </div>
                    <div class="exercise-step">
                        <div class="step-number"><i class="fas fa-bullseye"></i></div>
                        <div><strong>Techniek Effectiviteit:</strong> Voor/na meting per sessie</div>
                    </div>
                    <div class="exercise-step">
                        <div class="step-number"><i class="fas fa-clipboard-list"></i></div>
                        <div><strong>Trigger Patroon:</strong> Tijd, locatie, emotie, situatie loggen</div>
                    </div>
                </div>
            </div>

            <div class="exercise-card">
                <div class="exercise-header">
                    <div class="exercise-title">
                        <div class="exercise-icon"><i class="fas fa-first-aid"></i></div>
                        Noodprotocol
                    </div>
                    <div class="exercise-duration">
                        <i class="fas fa-clock"></i>
                        2-5 min
                    </div>
                </div>
                <h4>Bij Acute Symptomen:</h4>
                <div class="exercise-steps">
                    <div class="exercise-step">
                        <div class="step-number"><i class="fas fa-exclamation-triangle"></i></div>
                        <div><strong>Stap 1:</strong> Erken het symptoom zonder paniek</div>
                    </div>
                    <div class="exercise-step">
                        <div class="step-number"><i class="fas fa-square"></i></div>
                        <div><strong>Stap 2:</strong> Direct box breathing starten (4-4-4-4)</div>
                    </div>
                    <div class="exercise-step">
                        <div class="step-number"><i class="fas fa-user"></i></div>
                        <div><strong>Stap 3:</strong> Postuur controleren - recht zitten/staan</div>
                    </div>
                    <div class="exercise-step">
                        <div class="step-number"><i class="fas fa-tint"></i></div>
                        <div><strong>Stap 4:</strong> Slok water nemen, kaakspieren ontspannen</div>
                    </div>
                    <div class="exercise-step">
                        <div class="step-number"><i class="fas fa-edit"></i></div>
                        <div><strong>Stap 5:</strong> Na afloop: symptoom loggen in tracker</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Progress Tab -->
        <div id="progress" class="tab-content">
            <!-- Stats Cards at Top -->
            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <h3>
                        <div class="card-icon"><i class="fas fa-chart-line"></i></div>
                        Trend Analyse
                    </h3>
                    <div style="margin: 15px 0;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>Symptoom Intensiteit</span>
                            <span class="status-positive"><i class="fas fa-arrow-down"></i> -23%</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>Frequentie Gapen</span>
                            <span class="status-positive"><i class="fas fa-arrow-down"></i> -31%</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>Techniek Effectiviteit</span>
                            <span class="status-positive"><i class="fas fa-arrow-up"></i> +18%</span>
                        </div>
                    </div>
                </div>

                <div class="dashboard-card">
                    <h3>
                        <div class="card-icon"><i class="fas fa-trophy"></i></div>
                        Prestaties
                    </h3>
                    <div style="margin: 15px 0;">
                        <div class="achievement-badge achievement-bronze">
                            <i class="fas fa-medal"></i>
                            <div>
                                <strong>Beginner</strong><br>
                                <small>7 dagen achtereen geoefend</small>
                            </div>
                        </div>
                        <div class="achievement-badge achievement-locked">
                            <i class="fas fa-lock"></i>
                            <div>
                                <strong>Gevorderde</strong><br>
                                <small>14 dagen achtereen (nog 7 te gaan)</small>
                            </div>
                        </div>
                        <div class="achievement-badge achievement-locked">
                            <i class="fas fa-lock"></i>
                            <div>
                                <strong>Expert</strong><br>
                                <small>30 dagen achtereen</small>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="dashboard-card">
                    <h3>
                        <div class="card-icon"><i class="fas fa-bullseye"></i></div>
                        Beste Technieken
                    </h3>
                    <div style="margin: 15px 0;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span><i class="fas fa-square" style="margin-right: 5px; color: #00b894;"></i>Box Breathing</span>
                            <span style="font-weight: bold;">8.2/10</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span><i class="fas fa-lungs" style="margin-right: 5px; color: #00cec9;"></i>Diafragmatisch</span>
                            <span style="font-weight: bold;">7.8/10</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span><i class="fas fa-wind" style="margin-right: 5px; color: #74b9ff;"></i>Vagus Stimulatie</span>
                            <span style="font-weight: bold;">7.1/10</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span><i class="fas fa-meditation" style="margin-right: 5px; color: #a29bfe;"></i>Mindfulness</span>
                            <span style="font-weight: bold;">6.9/10</span>
                        </div>
                    </div>
                </div>

                <div class="dashboard-card">
                    <h3>
                        <div class="card-icon"><i class="fas fa-brain"></i></div>
                        Inzichten & Tips
                    </h3>
                    <div style="margin: 15px 0;">
                        <div style="padding: 10px; background: #e8f5e8; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid #00b894;">
                            <strong>💡 Patroon:</strong><br>
                            <small>34% minder symptomen met ochtend-oefeningen</small>
                        </div>
                        <div style="padding: 10px; background: #fff3cd; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid #fdcb6e;">
                            <strong>⚠️ Aandacht:</strong><br>
                            <small>Stress blijft grootste trigger (67%)</small>
                        </div>
                        <div style="padding: 10px; background: #e1f5fe; border-radius: 8px; border-left: 4px solid #74b9ff;">
                            <strong>🎯 Tip:</strong><br>
                            <small>Mindfulness voor stress-symptomen</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Week Overview -->
            <div class="progress-chart">
                <h3><i class="fas fa-calendar-week" style="margin-right: 10px; color: #a29bfe;"></i>Weekoverzicht</h3>
                <div class="week-grid">
                    <div class="day-card day-completed">
                        <div style="font-weight: bold;">Ma</div>
                        <div class="day-icon"><i class="fas fa-check-circle status-positive"></i></div>
                        <div style="font-size: 0.9em;">6/8 taken</div>
                    </div>
                    <div class="day-card day-completed">
                        <div style="font-weight: bold;">Di</div>
                        <div class="day-icon"><i class="fas fa-check-circle status-positive"></i></div>
                        <div style="font-size: 0.9em;">8/8 taken</div>
                    </div>
                    <div class="day-card day-partial">
                        <div style="font-weight: bold;">Wo</div>
                        <div class="day-icon"><i class="fas fa-exclamation-circle status-warning"></i></div>
                        <div style="font-size: 0.9em;">4/8 taken</div>
                    </div>
                    <div class="day-card day-today">
                        <div style="font-weight: bold;">Do</div>
                        <div class="day-icon"><i class="fas fa-calendar-day"></i></div>
                        <div style="font-size: 0.9em;">Vandaag</div>
                    </div>
                    <div class="day-card day-future">
                        <div style="font-weight: bold;">Vr</div>
                        <div class="day-icon"><i class="fas fa-pause-circle"></i></div>
                        <div style="font-size: 0.9em;">-</div>
                    </div>
                    <div class="day-card day-future">
                        <div style="font-weight: bold;">Za</div>
                        <div class="day-icon"><i class="fas fa-pause-circle"></i></div>
                        <div style="font-size: 0.9em;">-</div>
                    </div>
                    <div class="day-card day-future">
                        <div style="font-weight: bold;">Zo</div>
                        <div class="day-icon"><i class="fas fa-pause-circle"></i></div>
                        <div style="font-size: 0.9em;">-</div>
                    </div>
                </div>
            </div>

            <!-- Essential Charts Only -->
            <!-- Symptom Intensity Trend Chart -->
            <div class="progress-chart">
                <h3><i class="fas fa-chart-line" style="margin-right: 10px; color: #00b894;"></i>Symptoom Intensiteit Trend (14 dagen)</h3>
                <div style="height: 300px; position: relative;">
                    <canvas id="symptomTrendChart"></canvas>
                </div>
            </div>

            <!-- Charts Grid - Only Most Useful -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px; margin-bottom: 30px;">
                <!-- Symptom Distribution Chart -->
                <div class="progress-chart">
                    <h3><i class="fas fa-chart-pie" style="margin-right: 10px; color: #74b9ff;"></i>Symptoom Verdeling</h3>
                    <div style="height: 300px; position: relative;">
                        <canvas id="symptomDistributionChart"></canvas>
                    </div>
                </div>

                <!-- Technique Effectiveness Chart -->
                <div class="progress-chart">
                    <h3><i class="fas fa-chart-bar" style="margin-right: 10px; color: #fdcb6e;"></i>Techniek Effectiviteit</h3>
                    <div style="height: 300px; position: relative;">
                        <canvas id="techniqueEffectivenessChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Activity Heatmap -->
            <div class="progress-chart">
                <h3><i class="fas fa-calendar-alt" style="margin-right: 10px; color: #e17055;"></i>Activiteit Heatmap (Laatste 30 dagen)</h3>
                <div id="activityHeatmap" style="padding: 20px; background: #f8f9fa; border-radius: 10px; margin-bottom: 20px;">
                    <!-- Heatmap will be generated here -->
                </div>
            </div>

            <!-- Export Section -->
            <div class="progress-chart">
                <h3><i class="fas fa-download" style="margin-right: 10px; color: #a29bfe;"></i>Exporteer Gegevens</h3>
                <p style="margin-bottom: 20px;">Download je voortgangsgegevens voor je zorgverlener of eigen analyse.</p>
                <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                    <button class="submit-btn" onclick="exportData('csv')">
                        <i class="fas fa-file-csv"></i>
                        CSV Export
                    </button>
                    <button class="submit-btn" onclick="exportData('pdf')">
                        <i class="fas fa-file-pdf"></i>
                        PDF Rapport
                    </button>
                    <button class="submit-btn" onclick="exportData('email')">
                        <i class="fas fa-envelope"></i>
                        Email Samenvatting
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Sync Indicator -->
    <div class="sync-indicator" id="syncIndicator">
        <i class="fas fa-sync-alt"></i>
        <span>Gegevens synchroniseren...</span>
    </div>

    <!-- Firebase Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-app-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-auth-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-firestore-compat.min.js"></script>
    <!-- Chart.js for visualizations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.min.js"></script>

    <script>
        // Firebase Configuration (Demo - vervang met je eigen config)
        const firebaseConfig = {
            apiKey: "demo-api-key",
            authDomain: "breathease-demo.firebaseapp.com",
            projectId: "breathease-demo",
            storageBucket: "breathease-demo.appspot.com",
            messagingSenderId: "123456789",
            appId: "demo-app-id"
        };

        // Initialize Firebase (Demo mode - replace with actual config)
        let app, auth, db;
        let currentUser = null;
        let isDemo = true; // Set to false when using real Firebase

        if (!isDemo) {
            try {
                app = firebase.initializeApp(firebaseConfig);
                auth = firebase.auth();
                db = firebase.firestore();
            } catch (error) {
                console.warn('Firebase not available, running in demo mode');
                isDemo = true;
            }
        }

        // Global variables for timers and data
        let currentTimer = null;
        let timerInterval = null;
        let breathingPhase = 'prepare';
        let isTimerRunning = false;
        let syncTimeout = null;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            if (isDemo) {
                // Demo mode - skip auth
                initializeDemoUser();
            } else {
                // Real Firebase mode
                auth.onAuthStateChanged(handleAuthStateChange);
            }
        });

        function initializeDemoUser() {
            currentUser = { 
                uid: 'demo-user', 
                email: 'demo@example.com', 
                displayName: 'Demo Gebruiker' 
            };
            showMainApp();
            showNotification('Demo modus actief - data wordt lokaal opgeslagen', 'info');
        }

        function handleAuthStateChange(user) {
            document.getElementById('loadingScreen').classList.add('hidden');
            
            if (user) {
                currentUser = user;
                showMainApp();
            } else {
                currentUser = null;
                showAuthModal();
            }
        }

        function showMainApp() {
            document.getElementById('loadingScreen').classList.add('hidden');
            document.getElementById('authModal').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            
            // Update user info
            updateUserProfile();
            
            // Set current date/time for symptom tracker
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            document.getElementById('symptomDateTime').value = now.toISOString().slice(0, 16);
            
            // Load saved data
            loadDashboardData();
            loadChecklistState();
            
            // Hide sync indicator initially
            document.getElementById('syncIndicator').style.display = 'none';
        }

        function showAuthModal() {
            document.getElementById('loadingScreen').classList.add('hidden');
            document.getElementById('authModal').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
        }

        function updateUserProfile() {
            if (currentUser) {
                const userName = currentUser.displayName || currentUser.email.split('@')[0];
                const userAvatar = userName.charAt(0).toUpperCase();
                
                document.getElementById('userName').textContent = userName;
                document.getElementById('userAvatar').textContent = userAvatar;
            }
        }

        // Authentication functions
        function showAuthTab(tabName) {
            document.querySelectorAll('.auth-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(form => form.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + 'Form').classList.add('active');
            
            clearAuthMessages();
        }

        function clearAuthMessages() {
            document.getElementById('authError').style.display = 'none';
            document.getElementById('authSuccess').style.display = 'none';
        }

        function showAuthError(message) {
            const errorEl = document.getElementById('authError');
            errorEl.textContent = message;
            errorEl.style.display = 'block';
        }

        function showAuthSuccess(message) {
            const successEl = document.getElementById('authSuccess');
            successEl.textContent = message;
            successEl.style.display = 'block';
        }

        // Login form handler
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            clearAuthMessages();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (isDemo) {
                // Demo login
                setTimeout(() => {
                    initializeDemoUser();
                }, 1000);
                return;
            }
            
            try {
                await auth.signInWithEmailAndPassword(email, password);
            } catch (error) {
                showAuthError('Inloggen mislukt: ' + error.message);
            }
        });

        // Register form handler
        document.getElementById('registerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            clearAuthMessages();
            
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            
            if (password !== confirmPassword) {
                showAuthError('Wachtwoorden komen niet overeen');
                return;
            }
            
            if (password.length < 6) {
                showAuthError('Wachtwoord moet minimaal 6 karakters lang zijn');
                return;
            }
            
            if (isDemo) {
                // Demo registration
                showAuthSuccess('Account aangemaakt! Je wordt ingelogd...');
                setTimeout(() => {
                    initializeDemoUser();
                }, 1500);
                return;
            }
            
            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                await userCredential.user.updateProfile({ displayName: name });
                
                // Initialize user data
                await initializeUserData(userCredential.user.uid);
                
            } catch (error) {
                showAuthError('Registratie mislukt: ' + error.message);
            }
        });

        async function signInWithGoogle() {
            if (isDemo) {
                initializeDemoUser();
                return;
            }
            
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                const result = await auth.signInWithPopup(provider);
                
                // Check if new user and initialize data
                if (result.additionalUserInfo.isNewUser) {
                    await initializeUserData(result.user.uid);
                }
            } catch (error) {
                showAuthError('Google inloggen mislukt: ' + error.message);
            }
        }

        async function signOut() {
            if (isDemo) {
                location.reload();
                return;
            }
            
            try {
                await auth.signOut();
            } catch (error) {
                showNotification('Uitloggen mislukt: ' + error.message, 'error');
            }
        }

        async function initializeUserData(uid) {
            if (isDemo) return;
            
            const userData = {
                profile: {
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    settings: {
                        notifications: true,
                        theme: 'light'
                    }
                },
                checklist: {},
                symptoms: [],
                exercises: []
            };
            
            await db.collection('users').doc(uid).set(userData);
        }

        // Data synchronization functions
        function showSyncIndicator(status, message) {
            const indicator = document.getElementById('syncIndicator');
            indicator.style.display = 'flex';
            indicator.className = `sync-indicator ${status}`;
            indicator.querySelector('span').textContent = message;
            
            // Auto-hide after 3 seconds for success states
            if (status === 'synced') {
                setTimeout(() => {
                    indicator.style.display = 'none';
                }, 3000);
            }
        }

        async function syncData(collection, data, operation = 'update') {
            if (isDemo) {
                // Simulate sync delay
                showSyncIndicator('syncing', 'Synchroniseren...');
                setTimeout(() => {
                    showSyncIndicator('synced', 'Gegevens gesynchroniseerd');
                }, 1000);
                return;
            }
            
            if (!currentUser) return;
            
            try {
                showSyncIndicator('syncing', 'Synchroniseren...');
                
                const userRef = db.collection('users').doc(currentUser.uid);
                
                if (operation === 'update') {
                    await userRef.update({
                        [`${collection}`]: data,
                        lastSync: firebase.firestore.FieldValue.serverTimestamp()
                    });
                } else if (operation === 'add') {
                    await userRef.update({
                        [`${collection}`]: firebase.firestore.FieldValue.arrayUnion(data),
                        lastSync: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }
                
                showSyncIndicator('synced', 'Gegevens gesynchroniseerd');
                
            } catch (error) {
                console.error('Sync error:', error);
                showSyncIndicator('error', 'Synchronisatie mislukt');
            }
        }

        function debounceSync(collection, data, operation = 'update') {
            if (syncTimeout) {
                clearTimeout(syncTimeout);
            }
            
            syncTimeout = setTimeout(() => {
                syncData(collection, data, operation);
            }, 2000); // Sync after 2 seconds of inactivity
        }

        // Tab functionality
        function showTab(tabName) {
            // Hide all tabs
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Remove active class from nav tabs
            const navTabs = document.querySelectorAll('.nav-tab');
            navTabs.forEach(tab => tab.classList.remove('active'));
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Checklist functionality
        function toggleChecklist(item, checklistId) {
            item.classList.toggle('completed');
            item.classList.add('syncing');
            
            updateDashboardProgress();
            saveChecklistState();
            
            // Remove syncing indicator after a delay
            setTimeout(() => {
                item.classList.remove('syncing');
            }, 2000);
        }

        function updateDashboardProgress() {
            const completed = document.querySelectorAll('.checklist-item.completed').length;
            const total = document.querySelectorAll('.checklist-item').length;
            document.getElementById('dailyProgress').textContent = `${completed}/${total}`;
        }

        function saveChecklistState() {
            const items = document.querySelectorAll('.checklist-item');
            const state = {};
            const today = new Date().toDateString();
            
            items.forEach((item, index) => {
                const checklistId = item.getAttribute('onclick').match(/'([^']+)'/)[1];
                state[checklistId] = item.classList.contains('completed');
            });
            
            // Save locally
            localStorage.setItem('checklistState', JSON.stringify(state));
            localStorage.setItem('checklistDate', today);
            
            // Sync to cloud
            debounceSync('checklist', { [today]: state });
            
            updateStreak();
        }

        function loadChecklistState() {
            const savedDate = localStorage.getItem('checklistDate');
            const today = new Date().toDateString();
            
            if (savedDate === today) {
                const state = JSON.parse(localStorage.getItem('checklistState') || '{}');
                const items = document.querySelectorAll('.checklist-item');
                
                items.forEach((item, index) => {
                    const checklistId = item.getAttribute('onclick').match(/'([^']+)'/)[1];
                    if (state[checklistId]) {
                        item.classList.add('completed');
                    }
                });
            }
            updateDashboardProgress();
        }

        // Symptom tracker functionality
        function updateIntensityValue() {
            const slider = document.getElementById('intensitySlider');
            document.getElementById('intensityValue').textContent = slider.value;
        }

        document.getElementById('symptomForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitSymptomBtn');
            submitBtn.disabled = true;
            submitBtn.classList.add('loading');
            
            try {
                // Collect form data
                const symptomData = {
                    id: Date.now().toString(),
                    dateTime: document.getElementById('symptomDateTime').value,
                    mainSymptom: document.getElementById('mainSymptom').value,
                    intensity: parseInt(document.getElementById('intensitySlider').value),
                    duration: parseInt(document.getElementById('duration').value) || 0,
                    triggers: Array.from(document.querySelectorAll('#tracker input[type="checkbox"]:checked')).map(cb => cb.value),
                    effectiveness: parseInt(document.getElementById('effectivenessSlider').value),
                    notes: document.getElementById('notes').value,
                    timestamp: new Date().toISOString(),
                    userId: currentUser?.uid || 'demo-user'
                };
                
                // Save locally
                let savedSymptoms = JSON.parse(localStorage.getItem('symptoms') || '[]');
                savedSymptoms.push(symptomData);
                localStorage.setItem('symptoms', JSON.stringify(savedSymptoms));
                
                // Sync to cloud
                await syncData('symptoms', symptomData, 'add');
                
                showNotification('Symptomen succesvol opgeslagen!', 'success');
                
                // Reset form
                e.target.reset();
                document.getElementById('symptomDateTime').value = new Date(Date.now() - new Date().getTimezoneOffset() * 60000).toISOString().slice(0, 16);
                document.getElementById('intensityValue').textContent = '5';
                
                // Update dashboard
                loadDashboardData();
                
            } catch (error) {
                console.error('Error saving symptom:', error);
                showNotification('Fout bij opslaan van symptomen', 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.classList.remove('loading');
            }
        });

        // Timer functionality
        function startTimer(type, duration) {
            document.getElementById('breathingTimer').classList.remove('hidden');
            currentTimer = { type, duration, remaining: duration };
            isTimerRunning = true;
            
            timerInterval = setInterval(updateTimer, 1000);
            document.getElementById('timerPhase').textContent = `${type.charAt(0).toUpperCase() + type.slice(1)} Oefening`;
        }

        function startBoxBreathing() {
            document.getElementById('breathingTimer').classList.remove('hidden');
            startBoxBreathingCycle();
        }

        function startBoxBreathingCycle() {
            const phases = [
                { name: 'Inademen', duration: 4, action: 'inhale' },
                { name: 'Vasthouden', duration: 4, action: 'hold' },
                { name: 'Uitademen', duration: 4, action: 'exhale' },
                { name: 'Vasthouden', duration: 4, action: 'hold' }
            ];
            
            let currentPhaseIndex = 0;
            let phaseTimer = 0;
            let cycles = 0;
            const maxCycles = 10; // Stop after 10 cycles
            
            function nextPhase() {
                if (cycles >= maxCycles) {
                    stopTimer();
                    showNotification('Box breathing sessie voltooid!', 'success');
                    return;
                }
                
                const phase = phases[currentPhaseIndex];
                document.getElementById('timerPhase').textContent = `${phase.name} (Cyclus ${Math.floor(cycles) + 1}/${maxCycles})`;
                
                const circle = document.getElementById('breathingCircle');
                circle.className = 'breathing-circle';
                if (phase.action === 'inhale') {
                    circle.classList.add('inhale');
                } else if (phase.action === 'exhale') {
                    circle.classList.add('exhale');
                }
                
                phaseTimer = phase.duration;
                
                const phaseInterval = setInterval(() => {
                    if (!isTimerRunning) {
                        clearInterval(phaseInterval);
                        return;
                    }
                    
                    document.getElementById('timerDisplay').textContent = `00:0${phaseTimer}`;
                    phaseTimer--;
                    
                    if (phaseTimer < 0) {
                        clearInterval(phaseInterval);
                        currentPhaseIndex = (currentPhaseIndex + 1) % phases.length;
                        
                        if (currentPhaseIndex === 0) {
                            cycles++;
                        }
                        
                        if (isTimerRunning) {
                            nextPhase();
                        }
                    }
                }, 1000);
            }
            
            isTimerRunning = true;
            nextPhase();
        }

        function startCO2Test() {
            if (!confirm('🎯 CO2 Tolerance Test\n\n1. Adem normaal uit\n2. Houd je adem vast\n3. Tel de seconden tot eerste drang om in te ademen\n4. Noteer dit getal\n\nReady om te starten?')) {
                return;
            }
            
            document.getElementById('breathingTimer').classList.remove('hidden');
            document.getElementById('timerDisplay').textContent = '00:00';
            document.getElementById('timerPhase').textContent = 'Adem uit en houd vast...';
            
            let seconds = 0;
            timerInterval = setInterval(() => {
                if (!isTimerRunning) return;
                
                seconds++;
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                document.getElementById('timerDisplay').textContent = 
                    `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }, 1000);
            
            isTimerRunning = true;
        }

        function updateTimer() {
            if (!currentTimer || !isTimerRunning) return;
            
            currentTimer.remaining--;
            const mins = Math.floor(currentTimer.remaining / 60);
            const secs = currentTimer.remaining % 60;
            
            document.getElementById('timerDisplay').textContent = 
                `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            
            if (currentTimer.remaining <= 0) {
                stopTimer();
                showNotification('Oefening voltooid!', 'success');
                logExerciseCompletion(currentTimer.type, currentTimer.duration);
            }
        }

        function pauseTimer() {
            isTimerRunning = !isTimerRunning;
            const btn = document.getElementById('pauseBtn');
            const icon = btn.querySelector('i');
            const text = btn.lastChild;
            
            if (isTimerRunning) {
                icon.className = 'fas fa-pause';
                text.textContent = ' Pauzeer';
            } else {
                icon.className = 'fas fa-play';
                text.textContent = ' Hervat';
            }
        }

        function stopTimer() {
            isTimerRunning = false;
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            document.getElementById('breathingTimer').classList.add('hidden');
            
            // Reset pause button
            const btn = document.getElementById('pauseBtn');
            btn.querySelector('i').className = 'fas fa-pause';
            btn.lastChild.textContent = ' Pauzeer';
            
            currentTimer = null;
        }

        function logExerciseCompletion(type, duration) {
            const exerciseData = {
                type: type,
                duration: duration,
                timestamp: new Date().toISOString(),
                userId: currentUser?.uid || 'demo-user'
            };
            
            // Save locally
            let exercises = JSON.parse(localStorage.getItem('exercises') || '[]');
            exercises.push(exerciseData);
            localStorage.setItem('exercises', JSON.stringify(exercises));
            
            // Update total time
            let totalTime = parseInt(localStorage.getItem('totalExerciseTime') || '0');
            totalTime += Math.round(duration / 60);
            localStorage.setItem('totalExerciseTime', totalTime.toString());
            
            // Sync to cloud
            syncData('exercises', exerciseData, 'add');
            
            loadDashboardData();
        }

        // Dashboard data loading
        function loadDashboardData() {
            // Load total exercise time
            const totalTime = localStorage.getItem('totalExerciseTime') || '0';
            document.getElementById('totalTime').textContent = totalTime;
            
            // Load symptoms data for average intensity
            const symptoms = JSON.parse(localStorage.getItem('symptoms') || '[]');
            const last7Days = symptoms.filter(s => {
                const symptomDate = new Date(s.timestamp);
                const weekAgo = new Date();
                weekAgo.setDate(weekAgo.getDate() - 7);
                return symptomDate >= weekAgo;
            });
            
            if (last7Days.length > 0) {
                const avgIntensity = last7Days.reduce((sum, s) => sum + parseInt(s.intensity), 0) / last7Days.length;
                document.getElementById('avgIntensity').textContent = avgIntensity.toFixed(1);
            }
            
            // Calculate streak
            const checklistDates = JSON.parse(localStorage.getItem('streakDates') || '[]');
            document.getElementById('streak').textContent = calculateStreak(checklistDates).toString();
        }

        function calculateStreak(dates) {
            if (dates.length === 0) return 0;
            
            dates.sort((a, b) => new Date(b) - new Date(a));
            let streak = 1;
            let currentDate = new Date(dates[0]);
            
            for (let i = 1; i < dates.length; i++) {
                const prevDate = new Date(dates[i]);
                const diffTime = currentDate - prevDate;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                if (diffDays === 1) {
                    streak++;
                    currentDate = prevDate;
                } else {
                    break;
                }
            }
            
            return streak;
        }

        function updateStreak() {
            const completed = document.querySelectorAll('.checklist-item.completed').length;
            const total = document.querySelectorAll('.checklist-item').length;
            
            if (completed === total) {
                const today = new Date().toDateString();
                let streakDates = JSON.parse(localStorage.getItem('streakDates') || '[]');
                
                if (!streakDates.includes(today)) {
                    streakDates.push(today);
                    localStorage.setItem('streakDates', JSON.stringify(streakDates));
                    
                    // Sync streak data
                    debounceSync('streakDates', streakDates);
                }
            }
        }

        // Notification system
        function showNotification(message, type = 'info') {
            // Remove existing notifications
            const existing = document.querySelector('.notification');
            if (existing) {
                existing.remove();
            }
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            // Show notification
            setTimeout(() => notification.classList.add('show'), 100);
            
            // Auto-hide after 4 seconds
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 4000);
        }

        // Data export functions
        function exportData(format) {
            const symptoms = JSON.parse(localStorage.getItem('symptoms') || '[]');
            const exercises = JSON.parse(localStorage.getItem('exercises') || '[]');
            const checklist = JSON.parse(localStorage.getItem('checklistState') || '{}');
            
            const exportData = {
                user: currentUser ? {
                    email: currentUser.email,
                    name: currentUser.displayName
                } : { name: 'Demo User' },
                exportDate: new Date().toISOString(),
                symptoms: symptoms,
                exercises: exercises,
                checklist: checklist,
                totalExerciseTime: localStorage.getItem('totalExerciseTime') || '0',
                streakDates: JSON.parse(localStorage.getItem('streakDates') || '[]')
            };
            
            switch (format) {
                case 'csv':
                    exportToCSV(exportData);
                    break;
                case 'pdf':
                    exportToPDF(exportData);
                    break;
                case 'email':
                    exportToEmail(exportData);
                    break;
            }
        }

        function exportToCSV(data) {
            if (data.symptoms.length === 0) {
                showNotification('Geen symptoomgegevens om te exporteren', 'info');
                return;
            }
            
            // Create CSV content
            const headers = ['Datum', 'Tijd', 'Symptoom', 'Intensiteit', 'Duur (min)', 'Triggers', 'Technieken', 'Effectiviteit', 'Notities'];
            let csvContent = headers.join(',') + '\n';
            
            data.symptoms.forEach(symptom => {
                const row = [
                    new Date(symptom.timestamp).toLocaleDateString('nl-NL'),
                    new Date(symptom.timestamp).toLocaleTimeString('nl-NL'),
                    symptom.mainSymptom,
                    symptom.intensity,
                    symptom.duration || 0,
                    '"' + (symptom.triggers || []).join(', ') + '"',
                    '"' + (symptom.techniques || []).join(', ') + '"',
                    symptom.effectiveness,
                    '"' + (symptom.notes || '').replace(/"/g, '""') + '"'
                ];
                csvContent += row.join(',') + '\n';
            });
            
            // Download CSV
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `breathease-export-${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('CSV bestand gedownload!', 'success');
        }

        function exportToPDF(data) {
            showNotification('PDF export functie komt binnenkort beschikbaar', 'info');
        }

        function exportToEmail(data) {
            const subject = encodeURIComponent('BreathEase Data Export');
            const body = encodeURIComponent(`
Hallo,

Bijgevoegd mijn BreathEase data export van ${new Date().toLocaleDateString('nl-NL')}:

- Totaal aantal symptomen geregistreerd: ${data.symptoms.length}
- Totaal aantal oefeningen voltooid: ${data.exercises.length}
- Totale oefentijd: ${data.totalExerciseTime} minuten
- Huidige streak: ${calculateStreak(data.streakDates)} dagen

Met vriendelijke groet,
${data.user.name || 'BreathEase gebruiker'}

---
Deze email is gegenereerd door de BreathEase app.
            `);
            
            window.location.href = `mailto:?subject=${subject}&body=${body}`;
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Escape key to close timers
            if (e.key === 'Escape' && isTimerRunning) {
                stopTimer();
            }
            
            // Space to pause/resume timer
            if (e.code === 'Space' && isTimerRunning) {
                e.preventDefault();
                pauseTimer();
            }
        });

        // Service Worker for offline functionality (if needed)
        if ('serviceWorker' in navigator && !isDemo) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js')
                    .then(function(registration) {
                        console.log('ServiceWorker registration successful');
                    })
                    .catch(function(err) {
                        console.log('ServiceWorker registration failed');
                    });
            });
        }

        // Cleanup function for when page unloads
        window.addEventListener('beforeunload', function() {
            if (isTimerRunning) {
                return 'Er loopt nog een ademhalingsoefening. Weet je zeker dat je de pagina wilt verlaten?';
            }
        });

        // Responsive handling for mobile
        function handleMobileMenus() {
            const navTabs = document.querySelector('.nav-tabs');
            if (window.innerWidth <= 768) {
                navTabs.style.position = 'sticky';
                navTabs.style.top = '0';
                navTabs.style.zIndex = '100';
                navTabs.style.backgroundColor = 'rgba(255,255,255,0.95)';
                navTabs.style.backdropFilter = 'blur(10px)';
                navTabs.style.padding = '10px 0';
                navTabs.style.margin = '0 -20px 20px -20px';
            }
        }

        window.addEventListener('resize', handleMobileMenus);
        window.addEventListener('load', handleMobileMenus);

        // PWA Installation prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent Chrome 67 and earlier from automatically showing the prompt
            e.preventDefault();
            // Stash the event so it can be triggered later.
            deferredPrompt = e;
            
            // Show install button/notification
            showNotification('Deze app kan als snelkoppeling worden geïnstalleerd!', 'info');
        });

        // Advanced features toggle for power users
        let advancedMode = localStorage.getItem('advancedMode') === 'true';
        
        function toggleAdvancedMode() {
            advancedMode = !advancedMode;
            localStorage.setItem('advancedMode', advancedMode.toString());
            
            // Show/hide advanced features
            const advancedFeatures = document.querySelectorAll('.advanced-feature');
            advancedFeatures.forEach(feature => {
                feature.style.display = advancedMode ? 'block' : 'none';
            });
            
            showNotification(
                advancedMode ? 'Geavanceerde modus ingeschakeld' : 'Geavanceerde modus uitgeschakeld', 
                'info'
            );
        }

        // Initialize advanced mode on load
        document.addEventListener('DOMContentLoaded', function() {
            const advancedFeatures = document.querySelectorAll('.advanced-feature');
            advancedFeatures.forEach(feature => {
                feature.style.display = advancedMode ? 'block' : 'none';
            });
        });

        // Double-click on header to toggle advanced mode
        document.querySelector('.header h1').addEventListener('dblclick', toggleAdvancedMode);

        // Data validation functions
        function validateSymptomData(data) {
            const errors = [];
            
            if (!data.mainSymptom) errors.push('Hoofdsymptoom is verplicht');
            if (!data.intensity || data.intensity < 1 || data.intensity > 10) errors.push('Intensiteit moet tussen 1 en 10 liggen');
            if (data.duration && (data.duration < 0 || data.duration > 480)) errors.push('Duur moet tussen 0 en 480 minuten liggen');
            
            return errors;
        }

        // Enhanced form validation
        document.getElementById('symptomForm').addEventListener('input', function(e) {
            const form = e.target.form;
            const submitBtn = document.getElementById('submitSymptomBtn');
            
            // Real-time validation feedback
            if (e.target.type === 'range') {
                const valueSpan = document.getElementById('intensityValue');
                if (valueSpan) {
                    valueSpan.textContent = e.target.value;
                    valueSpan.style.color = e.target.value > 7 ? '#e17055' : e.target.value > 4 ? '#fdcb6e' : '#00b894';
                }
            }
            
            // Enable/disable submit button based on form validity
            const isValid = form.checkValidity();
            submitBtn.disabled = !isValid;
            submitBtn.style.opacity = isValid ? '1' : '0.6';
        });

        // Auto-save draft functionality
        let draftTimer;
        function saveDraft() {
            const formData = {
                mainSymptom: document.getElementById('mainSymptom').value,
                intensity: document.getElementById('intensitySlider').value,
                duration: document.getElementById('duration').value,
                notes: document.getElementById('notes').value,
                timestamp: Date.now()
            };
            
            if (formData.mainSymptom || formData.notes) {
                localStorage.setItem('symptomDraft', JSON.stringify(formData));
            }
        }

        function loadDraft() {
            const draft = localStorage.getItem('symptomDraft');
            if (draft) {
                const data = JSON.parse(draft);
                const age = Date.now() - data.timestamp;
                
                // Only load draft if it's less than 1 hour old
                if (age < 3600000) {
                    if (confirm('Er is een niet-opgeslagen concept gevonden. Wil je dit herstellen?')) {
                        document.getElementById('mainSymptom').value = data.mainSymptom || '';
                        document.getElementById('intensitySlider').value = data.intensity || 5;
                        document.getElementById('duration').value = data.duration || '';
                        document.getElementById('notes').value = data.notes || '';
                        updateIntensityValue();
                    }
                }
                localStorage.removeItem('symptomDraft');
            }
        }

        // Add auto-save to form inputs
        document.querySelectorAll('#symptomForm input, #symptomForm select, #symptomForm textarea').forEach(input => {
            input.addEventListener('input', function() {
                clearTimeout(draftTimer);
                draftTimer = setTimeout(saveDraft, 2000);
            });
        });

        // Load draft on form focus
        document.getElementById('symptomForm').addEventListener('focusin', loadDraft, { once: true });

        // Clear draft on successful submit
        document.getElementById('symptomForm').addEventListener('submit', function() {
            localStorage.removeItem('symptomDraft');
        });

        // Performance monitoring
        if (window.performance && window.performance.mark) {
            window.performance.mark('app-start');
            
            window.addEventListener('load', function() {
                window.performance.mark('app-loaded');
                window.performance.measure('app-load-time', 'app-start', 'app-loaded');
                
                const measure = window.performance.getEntriesByName('app-load-time')[0];
                if (measure && measure.duration > 3000) {
                    console.warn('App load time is slow:', measure.duration + 'ms');
                }
            });
        }

        console.log('BreathEase App initialized successfully');

        // Chart variables
        let symptomTrendChart = null;
        let symptomDistributionChart = null;
        let techniqueEffectivenessChart = null;
        let dashboardSymptomChart = null;

        // Initialize charts when progress tab is shown
        function initializeCharts() {
            if (document.getElementById('progress').classList.contains('active')) {
                createSymptomTrendChart();
                createSymptomDistributionChart();
                createTechniqueEffectivenessChart();
                createActivityHeatmap();
            }
        }

        // Initialize dashboard chart
        function initializeDashboardChart() {
            if (document.getElementById('dashboard').classList.contains('active')) {
                createDashboardSymptomChart();
            }
        }

        // Create simplified symptom chart for dashboard
        function createDashboardSymptomChart() {
            const ctx = document.getElementById('dashboardSymptomChart');
            if (!ctx) return;

            const symptoms = JSON.parse(localStorage.getItem('symptoms') || '[]');
            const demoSymptoms = symptoms.length > 0 ? symptoms : generateDemoSymptomData();
            
            // Group symptoms by date and calculate average intensity
            const dailyData = {};
            demoSymptoms.forEach(symptom => {
                const date = new Date(symptom.timestamp).toLocaleDateString('nl-NL');
                if (!dailyData[date]) {
                    dailyData[date] = { total: 0, count: 0 };
                }
                dailyData[date].total += parseInt(symptom.intensity);
                dailyData[date].count++;
            });

            const labels = [];
            const intensityData = [];

            // Generate last 7 days for dashboard
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toLocaleDateString('nl-NL');
                labels.push(date.toLocaleDateString('nl-NL', { weekday: 'short' }));
                
                if (dailyData[dateStr]) {
                    intensityData.push((dailyData[dateStr].total / dailyData[dateStr].count).toFixed(1));
                } else {
                    intensityData.push(0);
                }
            }

            if (dashboardSymptomChart) {
                dashboardSymptomChart.destroy();
            }

            dashboardSymptomChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Intensiteit',
                        data: intensityData,
                        borderColor: '#00b894',
                        backgroundColor: 'rgba(0, 184, 148, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: '#00b894',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 10,
                            title: {
                                display: true,
                                text: 'Intensiteit (1-10)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Laatste 7 dagen'
                            }
                        }
                    }
                }
            });
        }

        // Chart.js default configuration
        Chart.defaults.font.family = 'Segoe UI';
        Chart.defaults.font.size = 12;
        Chart.defaults.color = '#2d3436';

        // Generate demo symptom data for charts
        function generateDemoSymptomData() {
            const symptoms = [];
            const symptomTypes = ['gaping', 'sighing', 'air-hunger', 'shortness', 'chest-tightness', 'dizzy', 'tingling'];
            const triggers = ['stress', 'anxiety', 'eating', 'lying', 'exercise', 'crowd', 'heat', 'confined'];
            const techniques = ['diaphragmatic', 'box', 'co2-training', 'vagus', 'mindfulness', 'posture'];
            
            for (let i = 14; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                
                // Generate 0-3 symptoms per day
                const symptomsPerDay = Math.floor(Math.random() * 4);
                
                for (let j = 0; j < symptomsPerDay; j++) {
                    symptoms.push({
                        timestamp: date.toISOString(),
                        mainSymptom: symptomTypes[Math.floor(Math.random() * symptomTypes.length)],
                        intensity: Math.floor(Math.random() * 6) + 3, // 3-8 range
                        triggers: [triggers[Math.floor(Math.random() * triggers.length)]],
                        techniques: [techniques[Math.floor(Math.random() * techniques.length)]],
                        effectiveness: Math.floor(Math.random() * 5) + 5 // 5-9 range
                    });
                }
            }
            return symptoms;
        }

        // Create Symptom Trend Chart
        function createSymptomTrendChart() {
            const ctx = document.getElementById('symptomTrendChart');
            if (!ctx) return;

            const symptoms = JSON.parse(localStorage.getItem('symptoms') || '[]');
            const demoSymptoms = symptoms.length > 0 ? symptoms : generateDemoSymptomData();
            
            // Group symptoms by date and calculate average intensity
            const dailyData = {};
            demoSymptoms.forEach(symptom => {
                const date = new Date(symptom.timestamp).toLocaleDateString('nl-NL');
                if (!dailyData[date]) {
                    dailyData[date] = { total: 0, count: 0 };
                }
                dailyData[date].total += parseInt(symptom.intensity);
                dailyData[date].count++;
            });

            const labels = [];
            const intensityData = [];
            const countData = [];

            // Generate last 14 days
            for (let i = 13; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toLocaleDateString('nl-NL');
                labels.push(date.toLocaleDateString('nl-NL', { weekday: 'short', day: 'numeric' }));
                
                if (dailyData[dateStr]) {
                    intensityData.push((dailyData[dateStr].total / dailyData[dateStr].count).toFixed(1));
                    countData.push(dailyData[dateStr].count);
                } else {
                    intensityData.push(0);
                    countData.push(0);
                }
            }

            if (symptomTrendChart) {
                symptomTrendChart.destroy();
            }

            symptomTrendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Gemiddelde Intensiteit',
                        data: intensityData,
                        borderColor: '#00b894',
                        backgroundColor: 'rgba(0, 184, 148, 0.1)',
                        tension: 0.4,
                        fill: true,
                        yAxisID: 'y'
                    }, {
                        label: 'Aantal Symptomen',
                        data: countData,
                        borderColor: '#fdcb6e',
                        backgroundColor: 'rgba(253, 203, 110, 0.1)',
                        tension: 0.4,
                        fill: false,
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Intensiteit (1-10)'
                            },
                            min: 0,
                            max: 10
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Aantal'
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    }
                }
            });
        }

        // Create Symptom Distribution Chart
        function createSymptomDistributionChart() {
            const ctx = document.getElementById('symptomDistributionChart');
            if (!ctx) return;

            const symptoms = JSON.parse(localStorage.getItem('symptoms') || '[]');
            const demoSymptoms = symptoms.length > 0 ? symptoms : generateDemoSymptomData();
            
            const symptomCounts = {};
            const symptomLabels = {
                'gaping': 'Gapen',
                'sighing': 'Zuchten', 
                'air-hunger': 'Luchthonger',
                'shortness': 'Kortademigheid',
                'chest-tightness': 'Borst beklemming',
                'dizzy': 'Duizeligheid',
                'tingling': 'Tintelingen'
            };

            demoSymptoms.forEach(symptom => {
                const type = symptom.mainSymptom;
                symptomCounts[type] = (symptomCounts[type] || 0) + 1;
            });

            const labels = Object.keys(symptomCounts).map(key => symptomLabels[key] || key);
            const data = Object.values(symptomCounts);
            const colors = ['#00b894', '#74b9ff', '#fdcb6e', '#e17055', '#a29bfe', '#fd79a8', '#00cec9'];

            if (symptomDistributionChart) {
                symptomDistributionChart.destroy();
            }

            symptomDistributionChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors.slice(0, labels.length),
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        }
                    }
                }
            });
        }

        // Create Technique Effectiveness Chart
        function createTechniqueEffectivenessChart() {
            const ctx = document.getElementById('techniqueEffectivenessChart');
            if (!ctx) return;

            const symptoms = JSON.parse(localStorage.getItem('symptoms') || '[]');
            const demoSymptoms = symptoms.length > 0 ? symptoms : generateDemoSymptomData();
            
            const techniqueStats = {};
            const techniqueLabels = {
                'diaphragmatic': 'Diafragmatisch',
                'box': 'Box Breathing',
                'co2-training': 'CO2 Training',
                'vagus': 'Vagus Stimulatie',
                'mindfulness': 'Mindfulness',
                'posture': 'Postuur'
            };

            demoSymptoms.forEach(symptom => {
                if (symptom.techniques && symptom.effectiveness) {
                    symptom.techniques.forEach(technique => {
                        if (!techniqueStats[technique]) {
                            techniqueStats[technique] = { total: 0, count: 0 };
                        }
                        techniqueStats[technique].total += parseInt(symptom.effectiveness);
                        techniqueStats[technique].count++;
                    });
                }
            });

            const labels = [];
            const data = [];
            const colors = [];
            const backgroundColors = ['#00b894', '#74b9ff', '#fdcb6e', '#e17055', '#a29bfe', '#fd79a8'];

            Object.keys(techniqueStats).forEach((technique, index) => {
                const avg = techniqueStats[technique].total / techniqueStats[technique].count;
                labels.push(techniqueLabels[technique] || technique);
                data.push(avg.toFixed(1));
                colors.push(backgroundColors[index % backgroundColors.length]);
            });

            if (techniqueEffectivenessChart) {
                techniqueEffectivenessChart.destroy();
            }

            techniqueEffectivenessChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Gemiddelde Effectiviteit',
                        data: data,
                        backgroundColor: colors,
                        borderRadius: 8,
                        borderSkipped: false,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 10,
                            title: {
                                display: true,
                                text: 'Effectiviteit (1-10)'
                            }
                        },
                        x: {
                            ticks: {
                                maxRotation: 45
                            }
                        }
                    }
                }
            });
        }

        // Create Activity Heatmap
        function createActivityHeatmap() {
            const container = document.getElementById('activityHeatmap');
            if (!container) return;

            container.innerHTML = '';
            
            const today = new Date();
            const monthNames = ['Jan', 'Feb', 'Mrt', 'Apr', 'Mei', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dec'];
            
            // Create calendar grid for last 30 days
            let html = '<div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; max-width: 300px;">';
            
            for (let i = 29; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                
                // Random activity level (0-4)
                const activity = Math.floor(Math.random() * 5);
                let color = '#f1f2f6';
                let title = 'Geen activiteit';
                
                switch (activity) {
                    case 1:
                        color = '#d1f2eb';
                        title = 'Lage activiteit';
                        break;
                    case 2:
                        color = '#a7f0ba';
                        title = 'Gemiddelde activiteit';
                        break;
                    case 3:
                        color = '#6bcf7f';
                        title = 'Hoge activiteit';
                        break;
                    case 4:
                        color = '#00b894';
                        title = 'Zeer hoge activiteit';
                        break;
                }
                
                html += `
                    <div style="
                        width: 12px; 
                        height: 12px; 
                        background: ${color}; 
                        border-radius: 2px;
                        border: 1px solid #ddd6fe;
                        cursor: pointer;
                        title: '${date.getDate()} ${monthNames[date.getMonth()]}: ${title}'
                    " title="${date.getDate()} ${monthNames[date.getMonth()]}: ${title}"></div>
                `;
            }
            
            html += '</div>';
            html += '<div style="margin-top: 15px; display: flex; align-items: center; justify-content: space-between; font-size: 0.8em; color: #636e72;">';
            html += '<span>Minder</span>';
            html += '<div style="display: flex; gap: 2px;">';
            html += '<div style="width: 10px; height: 10px; background: #f1f2f6; border-radius: 2px;"></div>';
            html += '<div style="width: 10px; height: 10px; background: #d1f2eb; border-radius: 2px;"></div>';
            html += '<div style="width: 10px; height: 10px; background: #a7f0ba; border-radius: 2px;"></div>';
            html += '<div style="width: 10px; height: 10px; background: #6bcf7f; border-radius: 2px;"></div>';
            html += '<div style="width: 10px; height: 10px; background: #00b894; border-radius: 2px;"></div>';
            html += '</div>';
            html += '<span>Meer</span>';
            html += '</div>';
            
            container.innerHTML = html;
        }

        // Update showTab function to initialize charts when progress tab is shown
        const originalShowTab = showTab;
        showTab = function(tabName) {
            originalShowTab.call(this, tabName);
            if (tabName === 'progress') {
                // Delay chart initialization to ensure DOM is ready
                setTimeout(initializeCharts, 100);
            } else if (tabName === 'dashboard') {
                // Initialize dashboard chart
                setTimeout(initializeDashboardChart, 100);
            }
        };

        // Initialize dashboard chart on app load
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(initializeDashboardChart, 500);
        });

        // Destroy charts when leaving progress tab to free memory
        function destroyCharts() {
            [symptomTrendChart, symptomDistributionChart, techniqueEffectivenessChart, dashboardSymptomChart].forEach(chart => {
                if (chart) {
                    chart.destroy();
                }
            });
        }

        // Update charts when new data is added
        function updateProgressCharts() {
            if (document.getElementById('progress').classList.contains('active')) {
                initializeCharts();
            }
            if (document.getElementById('dashboard').classList.contains('active')) {
                initializeDashboardChart();
            }
        }

        // Call updateProgressCharts when symptom data is added
        const originalSymptomSubmit = document.getElementById('symptomForm').onsubmit;
        document.getElementById('symptomForm').addEventListener('submit', function(e) {
            // Call original handler first, then update charts
            setTimeout(updateProgressCharts, 500);
        });
    </script>
</body>
</html>
